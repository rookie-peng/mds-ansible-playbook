---
# tasks file for common
- name: Taint node and Label node 
  shell: kubectl taint  node {{ node }} {{ tolerate_key }}=:NoSchedule --overwrite &&
         kubectl label  node {{ node }} {{ nodeselector_key }}={{ nodeselector_value }} --overwrite

- name: Create mds namespace
  k8s: 
    name: '{{ prometheus_stack_namespace }}'
    api_version: v1
    kind: Namespace
    state: present

- name: Create storageclass
  k8s: 
    state: present
    definition:
      apiVersion: storage.k8s.io/v1
      kind: StorageClass
      metadata:
        name: prometheus-storage
        namespace:
      provisioner: kubernetes.io/no-provisioner
      volumeBindingMode: WaitForFirstConsumer

- name: Create image pull secrets
  k8s:
    state: present
    definition: "{{ lookup('template', 'image.secret.yml') | from_yaml }}"
